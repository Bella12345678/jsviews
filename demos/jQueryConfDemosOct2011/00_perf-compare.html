<!DOCTYPE html PUBLIC>
<html>
<head>
	<title>Benchmark JsRender</title>
	<link href="resources/perf-compare.css" rel="stylesheet" type="text/css" />
	<script src="../../jquery-1.6.4.js" type="text/javascript"></script>
	<script src="../../jsrender.js" type="text/javascript"></script>
	<script src="../../test/benchmarks/jquery.tmpl-JQT.js" type="text/javascript"></script>
	<!--Fixed to avoid collision of $.template with JsRender-->

	<script src="../../test/benchmarks/dot.js" type="text/javascript"></script>
</head>
<body>

<h3>Perf comparison</h3>

<script id="jqueryTmplTemplate" type="text/x-jquery-tmpl">
	<div>
		<b>{{html Name}}</b> ({{html ReleaseYear}})
		<b>{{html Name}}</b> ({{html ReleaseYear}})
		<b>{{html Name}}</b> ({{html ReleaseYear}})
		<b>{{html Name}}</b> ({{html ReleaseYear}})
	</div>
</script>

<script id="jqueryTmplTemplateEncode" type="text/x-jquery-tmpl">
	<div>
		<b>${Name}</b> (${ReleaseYear})
		<b>${Name}</b> (${ReleaseYear})
		<b>${Name}</b> (${ReleaseYear})
		<b>${Name}</b> (${ReleaseYear})
	</div>
</script>

<script id="jsRenderTemplate" type="text/x-jquery-tmpl">
	<div>
		<b>{{=Name!}}</b> ({{=ReleaseYear!}})
		<b>{{=Name!}}</b> ({{=ReleaseYear!}})
		<b>{{=Name!}}</b> ({{=ReleaseYear!}})
		<b>{{=Name!}}</b> ({{=ReleaseYear!}})
	</div>
</script>

<script id="jsRenderTemplateEncode" type="text/x-jquery-tmpl">
	<div>
		<b>{{=Name}}</b> ({{=ReleaseYear}})
		<b>{{=Name}}</b> ({{=ReleaseYear}})
		<b>{{=Name}}</b> ({{=ReleaseYear}})
		<b>{{=Name}}</b> ({{=ReleaseYear}})
	</div>
</script>

<script id="dotTemplate" type="text/x-dot-tmpl">
	<div>
		<b>{{=it.Name}}</b> ({{=it.ReleaseYear}})
		<b>{{=it.Name}}</b> ({{=it.ReleaseYear}})
		<b>{{=it.Name}}</b> ({{=it.ReleaseYear}})
		<b>{{=it.Name}}</b> ({{=it.ReleaseYear}})
	</div>
</script>

<a href="index.html">Home</a> <a href="01_render-template.html">Next</a><br /><br />

<em>Rendered content:</em><br /><br />
<table><tbody id="output"></tbody></table>

<br /><em>Times in milliseconds:</em>
<table><tbody id="console"></tbody></table>


<script type="text/javascript">
	var ret,
		movie = { Name: "The <i>Red</i> Violin", ReleaseYear: "1998" },

		tmpl_doT = doT.template($( "#dotTemplate" )[0].innerHTML),
		tmpl_jQueryTmpl = $( "#jqueryTmplTemplate" ).templateJQT(),
		tmpl_JsRender = $( "#jsRenderTemplate" ).template(),
		tmpl_jQueryTmplEncode = $( "#jqueryTmplTemplateEncode" ).templateJQT(),
		tmpl_JsRenderEncode = $( "#jsRenderTemplateEncode" ).template();

	// Test render perf
	$( "#console" ).append( "<tr><td colspan='2'>____________________________________________</td></tr>" );
	$( "#console" ).append( "<tr><td colspan='2'><b>Render string</b></td></tr>");

	var dotRun = test( "doT render", 100000, function() {
		ret = tmpl_doT(movie);
	});
	var jsrRun = test( "JsRender render", 100000, function() {
		ret = tmpl_JsRender( movie );
	});
	var jqtRun = test( "jQuery Template render", 100000, function() {
		ret = tmpl_jQueryTmpl($, { data: movie }).join("");
	});

	// Test compile perf
	$( "#console" ).append( "<tr><td colspan='2'>____________________________________________</td></tr>" );
	$( "#console" ).append( "<tr><td colspan='2'><b>Compile</b></td></tr>");

	var dotCompile = test( "doT compile", 10000, function() {
		tmpl_doT = doT.template($( "#dotTemplate" )[0].innerHTML);
	});
	var jsrCompile = test( "JsRender compile", 10000, function() {
		tmpl_JsRender = $( "#jsRenderTemplate" ).template();
	});
	var jqtCompile = test( "jQuery Template compile", 10000, function() {
		tmpl_jQueryTmpl = $( "#jqueryTmplTemplate" ).templateJQT();
	});

	$( "#console" ).append( "<tr><td colspan='2'>____________________________________________</td></tr>" );
	$( "#console" ).append( "<tr><td colspan='2'><b>Compile plus Render</b></td></tr>");

	$( "#console" ).append( "<tr><td>doT comile plus render</td><td class='result'>" + parseInt(dotCompile + dotRun) + "</td></tr>");
	$( "#console" ).append( "<tr><td>JsRender comile plus render</td><td class='result'>" + parseInt(jsrCompile + jsrRun) + "</td></tr>");
	$( "#console" ).append( "<tr><td>jQuery Template comile plus render</td><td class='result'>" + parseInt(jqtCompile + jqtRun) + "</td></tr>");

//	$( "#console" ).append( "<tr><td colspan='2'>____________________________________________</td></tr>" );
//	$( "#console" ).append( "<tr><td colspan='2'><b>Full features - view hierarchy etc.</b></td></tr>");

//	ret = $( "#output" ).html();
//	test( "JsRender full features - to string", 10000, function() {
//		ret = $.render( tmpl_JsRender, movie );
//	});
//	test( "JsRender full features - inserted in DOM", 10000, function() {
//		$( "#output" ).html( ret = $.render( tmpl_JsRender, movie ));
//	});
//	test( "jQuery Template full features - inserted in DOM", 10000, function() {
//		$( "#output" ).empty();
//		$.tmpl( tmpl_jQueryTmpl, movie ).appendTo( "#output" );
//	});

//	$( "#console" ).append( "<tr><td colspan='2'>____________________________________________</td></tr>" );
//	$( "#console" ).append( "<tr><td colspan='2'><b>Rendering to string, with HTML encoding</b></td></tr>");

//	test( "JsRender Encode", 10000, function() {
//		ret = tmpl_JsRenderEncode( movie );
//	});
//	test( "jQuery Template Encode", 10000, function() {
//		ret =tmpl_jQueryTmplEncode($, { data: movie }).join("");
//	});
//	$( "#console" ).append( "<tr><td colspan='2'>____________________________________________</td></tr>" );
	$( "#output" ).html( ret );


function test( label, times, cb ) {
	count = times;
	startTime = new Date().valueOf();
	while (count--) {
		cb();
	}
	endTime = new Date().valueOf();
	result = parseInt((( endTime-startTime ) * 10000 ) / times)/10;
	$( "#console" ).append( "<tr><td>" + label + ": </td><td class='result'>" + result + "</td></tr>");
	return result;
}
</script>

<!--================ End of Demo Section ================-->


</body>
</html>
